const autoline_add={};!function(e){let t=e(".cf7-google-map-container").closest("form.wpcf7-form");if(t.on("click",".cf7-google-map-search",function(t){let a=e(t.originalEvent.target);a.is(".dashicons-search")?(a.hide(),a.siblings(".dashicons-no-alt").show(),a.siblings(".cf7marker-address").show().val("").focus()):a.is(".dashicons-no-alt")&&a.closeCF7gmapSearchField()}),e.fn.initCF7googleMap=function(){e(this).each(function(t,a){let o=e(a);if(!o.is(".cf7-google-map-container"))return!1;let l=e(".cf7-googlemap",o),n=l.attr("id").replace("cf7-googlemap-",""),i=e(".cf7-googlemap-field",o).attr("id"),r,s,c,g=o.data("show-address"),d=l.closest("form.wpcf7-form"),u=e("input#search-"+i,o),p=e("input#manual-address-"+i,o),m=e("#lat-"+i,o),f=e("#lng-"+i,o),v=e("#clat-"+i,o),y=e("#clng-"+i,o),b=e("#zoom-"+i,o),h=e("#address-"+i,o);e("input#"+i,o),autoline_add[i]="",o.on("update.cf7-google-map",function(e){g&&h.val(JSON.stringify(Object.values(e.address)))});let k=v.val(),w=y.val(),$=m.val(),q=f.val(),S=b.val(),E={center:[""!=k?k:o.data("clat"),""!=w?w:o.data("clng")],zoom:""!=S?parseInt(S):parseInt(o.data("zoom")),mapTypeId:google.maps.MapTypeId[cf7GoogleMap.fields[n].map_type]},M={position:[""!=$?$:o.data("lat"),""!=q?q:o.data("lng")]};e(".cf7-googlemap-address-line",o).on("change",function(t){e(this).val()!=autoline_add[i]&&p.val(!0);let a={gm3:c,gmap:s,marker:r,address:{line:e("input#line-"+i,o).val(),city:e("input#city-"+i,o).val(),state:e("input#state-"+i,o).val(),country:e("input#country-"+i,o).val()},bubbles:!0,cancelable:!0};o.trigger(e.Event("update.cf7-google-map",a)),a=new CustomEvent("update/cf7-google-map",{detail:a}),o.get(0).dispatchEvent(a)}),d.on("tabsactivate",function(t){e.contains(e(t.trigger),l)&&google.maps.event.trigger(l,"resize")}),d.on("accordionactivate",function(t){e.contains(e(t.trigger),l)&&google.maps.event.trigger(l,"resize")}),l.is(".wpcf7-validates-as-required")&&o.on("drag.cf7-google-map",function(){e(".wpcf7-not-valid-tip",o).remove()}),(c=l.gmap3({...E,...cf7GoogleMap.fields[n].gmap3_settings})).marker({...M,...cf7GoogleMap.fields[n].marker_settings}).on("dragend",fireMarkerUpdate).then(function(t){let a={gm3:c,gmap:s=this.get(0),marker:r=this.get(1),settings:{center:[v.val(),y.val()],zoom:b.val(),type:cf7GoogleMap.fields[n].map_type,marker:[m.val(),f.val()]},bubbles:!0,cancelable:!0};o.trigger(e.Event("init.cf7-google-map",a)),a=new CustomEvent("init/cf7-google-map",{detail:a}),o[0].dispatchEvent(a)});let z=l.css("width");u.css("width","calc("+z+" - 10px)");let A=function(){z=l.css("width"),u.css("width","calc("+z+" - 10px)"),google.maps.event.trigger(s,"resize")};l.resize(A),e(window).resize(A),cf7GoogleMap.places&&o.on("init/cf7-google-map",function(t){let a=this,o=null,l;l=[t.detail.marker];let n=a.querySelector(".cf7-googlemap").getAttribute("id").replace("cf7-googlemap-",""),i=a.querySelector(".cf7-googlemap-field").getAttribute("id");gm3[i]=t.detail.gm3,gmap[i]=t.detail.gmap;let s=a.querySelector("#search-"+i);o=new google.maps.places.SearchBox(s),gmap[i].addListener("bounds_changed",function(e){o.setBounds(gmap[i].getBounds())}),o.addListener("places_changed",function(t){let c=o.getPlaces();if(0==c.length)return;l.forEach(function(e){e.setMap(null),e=null}),l=[];let g=new google.maps.LatLngBounds;c.forEach(function(e){if(!e.geometry){console.log("Returned place contains no geometry");return}cf7GoogleMap.fields[n].marker_settings.icon,r=gm3[i].marker({draggable:cf7GoogleMap.fields[n].marker_settings.draggable,icon:cf7GoogleMap.fields[n].marker_settings.icon,title:e.name,position:e.geometry.location}).on("dragend",fireMarkerUpdate).then(function(t){if(l.push(t),a.querySelector("#"+i).value=e.geometry.location.lat()+","+e.geometry.location.lng(),a.getAttribute("data-show-address")){let o=parseGeolocationAddress("",e.address_components),n={gm3:gm3[i],gmap:gmap[i],marker:l[0],address:o,bubbles:!0,cancelable:!0};if(jQuery(a).trigger(jQuery.Event("update.cf7-google-map",n)),n=new CustomEvent("update/cf7-google-map",{detail:n}),a.dispatchEvent(n),null!==a.querySelector("div.cf7-googlemap-address-fields")){let r=o.state;""!=o.pin&&(r=o.state+" "+o.pin),autoline_add[i]=o.line,a.querySelector("#country-"+i).value=o.country,a.querySelector("#state-"+i).value=r,a.querySelector("#city-"+i).value=o.city,a.querySelector("#line-"+i).value=o.line}}}),a.querySelector("#lat-"+i).value=e.geometry.location.lat(),a.querySelector("#lng-"+i).value=e.geometry.location.lng(),e.geometry.viewport?g.union(e.geometry.viewport):g.extend(e.geometry.location)}),gmap[i].fitBounds(g),e(s).closeCF7gmapSearchField()})})})},e.fn.closeCF7gmapSearchField=function(){let t=e(this);t.hide(),t.siblings(".cf7marker-address").hide(),t.siblings(".dashicons-no-alt").hide(),t.siblings(".dashicons-search").show()},cf7GoogleMap.plane_mode)$et_map.append('<p style="text-align: center;padding: 93px 0;border: solid 1px;"><em>airplane mode</em></p>');else{t.filter(".cf7_2_post form.wpcf7-form").each(function(){let t=e(this),a=t.closest(".cf7_2_post").attr("id");t.on(a,function(a){e(".cf7-google-map-container",t).initCF7googleMap()})}),t.on("sgTabAdded sgRowAdded",function(t){let a=e(t.target);"sgRowAdded"==t.type&&(a=e(".cf7-sg-table[data-row="+t.row+"]",a)),e(".cf7-google-map-container",a).initCF7googleMap()});let a=e(".cf7-google-map-container",t.not(".cf7_2_post form.wpcf7-form"));e(document).ready(function(){a.each(function(){let t=e(this),a=e(".cf7-googlemap-field",t).attr("id");cf7GoogleMap.fields[a].init&&t.initCF7googleMap()})}),a.on("initialise-cf7-gmap",function(){e(this).initCF7googleMap()})}}(jQuery);const cf7_geocoder=!cf7GoogleMap.plane_mode&&cf7GoogleMap.geocode?new google.maps.Geocoder:null,gm3={},gmap={};function fireMarkerUpdate(e,t){let a=this.$.closest(".cf7-google-map-container").get(0),o=a.querySelector(".cf7-googlemap").getAttribute("id").replace("cf7-googlemap-",""),l=a.getElementsByClassName("cf7-googlemap-field")[0].getAttribute("id"),n=a.querySelector("#lat-"+l),i=a.querySelector("#lng-"+l),r=a.querySelector("#clat-"+l),s=a.querySelector("#clng-"+l),c=a.querySelector("#zoom-"+l),g=(a.querySelector("#address-"+l),a.querySelector("#"+l));if(n.value=e.getPosition().lat(),i.value=e.getPosition().lng(),g.value=e.getPosition().lat()+","+e.getPosition().lng(),c.value=e.getMap().zoom,r.value=e.getMap().getCenter().lat(),s.value=e.getMap().getCenter().lng(),"true"==a.querySelector("#manual-address-"+l).value)return;let d={lat:e.getPosition().lat(),lng:e.getPosition().lng()};cf7GoogleMap.geocode&&cf7_geocoder.geocode({location:d},function(t,o){if("OK"===o){if(t[1]&&a.getAttribute("data-show-address")){let n=parseGeolocationAddress("",t[1].address_components),i={gm3:gm3[l],gmap:gmap[l],marker:e,address:n,bubbles:!0,cancelable:!0};if(jQuery(a).trigger(jQuery.Event("update.cf7-google-map",i)),i=new CustomEvent("update/cf7-google-map",{detail:i}),a.dispatchEvent(i),null!==a.querySelector("div.cf7-googlemap-address-fields")){let r=n.state;""!=n.pin&&(r=n.state+" "+n.pin),autoline_add[l]=n.line,a.querySelector("#country-"+l).value=n.country,a.querySelector("#state-"+l).value=r,a.querySelector("#city-"+l).value=n.city,a.querySelector("#line-"+l).value=n.line}}}else window.alert("Google Geocoder failed due to: "+o)});let u={settings:{center:[r.value,s.value],zoom:c.value,type:cf7GoogleMap.fields[o].map_type,marker:[n.value,i.value]},bubbles:!0,cancelable:!0};jQuery(a).trigger(jQuery.Event("drag.cf7-google-map",u)),u=new CustomEvent("drag/cf7-google-map",{detail:u}),a.dispatchEvent(u)}function parseGeolocationAddress(e,t){let a,o,l,n="",i="",r="",s="",c="",g=["","","",""],d=["","","","","",""],u=["","","","",""];for(""!=e&&(g[0]=e),a=0;a<t.length;a++)for(o=0,l=t[a];o<l.types.length;o++)switch(l.types[o]){case"bus_station":case"establishment":case"point_of_interest":case"transit_station":case"premise":case"subpremise":g[0]=l.long_name;break;case"street_number":g[1]=l.long_name;break;case"street_address":g[2]=l.long_name;break;case"route":g[3]=l.long_name;break;case"neighborhood":case"sublocality_level_5":d[0]=l.long_name;break;case"sublocality_level_4":d[1]=l.long_name;break;case"sublocality_level_3":d[2]=l.long_name;break;case"sublocality_level_2":d[3]=l.long_name;break;case"sublocality":o==l.types.length&&(d[4]=l.long_name);break;case"sublocality_level_1":d[4]=l.long_name;break;case"locality":d[5]=l.long_name;break;case"administrative_area_level_5":u[0]=l.long_name;break;case"administrative_area_level_4":u[1]=l.long_name;break;case"administrative_area_level_3":u[2]=l.long_name;break;case"administrative_area_level_2":u[3]=l.long_name;break;case"administrative_area_level_1":u[4]=l.long_name;break;case"country":s=l.long_name;case"postal_code":r=l.long_name}for(a=0,g=jQuery.unique(g),d=jQuery.unique(d),u=jQuery.unique(u);a<g.length;a++)""!=g[a]&&(c+=g[a]+", ");for(a=0;a<d.length;a++)""!=d[a]&&(n+=d[a]+", ");for(a=0;a<u.length;a++)""==u[a]||~d.indexOf(u[a])||(i+=u[a]+", ");return{line:c,city:n,state:i,pin:r,country:s}}